# Demographic
demographic:
  - root: //*[local-name()='patient']
    generated_id:
      # random uuid4
      namespace: 7fdd5f16-188e-4dae-89bb-c207427db3a7
      name: ./shared:bcr_patient_uuid
    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid
          nullable: false
    properties:
      submitter_id:
        # xpath support concat too, but it will return the suffix
        # if no path is found instead of not found
        path: ./shared:bcr_patient_barcode
        suffix: _demographic
        type: str

      gender:
        path: ./shared:gender
        type: str.lower
        default: not reported

      race:
        path: ./shared:race|./clin_shared:race_list/clin_shared:race[1]
        type: str.lower
        default: not reported

      ethnicity:
        path: ./shared:ethnicity|./clin_shared:ethnicity
        type: str.lower
        default: not reported

      days_to_death:
        evaluator:
          name: filter
        path: //shared:days_to_death[not(@procurement_status = "Not Applicable" or @procurement_status = "Not Available")]|//clin_shared:days_to_death[not(@procurement_status = "Not Applicable" or @procurement_status = "Not Available")]
        type: int
        maximum: 32872
        minimum: -32872

      age_at_index:
        path: ./clin_shared:age_at_initial_pathologic_diagnosis
        type: int

      days_to_birth:
        path: ./shared:days_to_birth|./clin_shared:days_to_birth
        type: int
        minimum: -32872
        maximum: 0
        default: null

      vital_status:
        evaluator:
          name: vital_status
          follow_up_path: //shared:days_to_last_followup|//clin_shared:days_to_last_followup
        path: ./shared:vital_status|./clin_shared:vital_status
        type: str.title
        default: not reported

diagnosis:
  - root: //*[local-name()='patient']
    generated_id:
      namespace: 0e34df64-b3ab-4b07-b750-e8690ee28eaf
      name: ./shared:bcr_patient_uuid
    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid
          nullable: false
          type: str.lower
    properties:
        submitter_id:
          path: ./shared:bcr_patient_barcode
          suffix: _diagnosis
          type: str

        age_at_diagnosis:
          path: ./shared:days_to_birth|./clin_shared:days_to_birth * -1
          type: int
          maximum: 32872
          minimum: 0
          term:

        days_to_last_follow_up:
          evaluator:
            name: last_follow_up
          path: //shared:days_to_last_followup|//clin_shared:days_to_last_followup
          type: int
          maximum: 32872
          minimum: -32872
          default: null

        primary_diagnosis:
          path: ./shared:icd_10|./clin_shared:icd_10
          type: str
          default: not reported

        morphology:
          path: ./shared:icd_o_3_histology|./clin_shared:icd_o_3_histology
          type: str
          default: Not Reported

        tissue_or_organ_of_origin:
          path: ./shared:icd_o_3_site|./clin_shared:icd_o_3_site # is this right?
          type: str
          default: not reported

        site_of_resection_or_biopsy:
          path: ./shared:icd_o_3_site|./clin_shared:icd_o_3_site # is this right?
          type: str
          default: not reported

        classification_of_tumor:
          path: "primary"
          type: str
          default: not reported

        prior_malignancy:
          path: ./shared:other_dx
          default: not reported
          type: str.lower
          values:
            'No':
              - 'no'
              - yes, history of synchronous/bilateral malignancy
            'Yes':
              - 'yes'
              - yes, history of prior malignancy

        synchronous_malignancy:
          path: ./shared:other_dx
          default: not reported
          type: str.title
          values:
            'Yes':
              - yes, history of synchronous/bilateral malignancy
            'No':
              - 'no'
              - yes, history of prior malignancy
            not reported:
              - 'yes'

        tumor_stage:
          path: ./shared_stage:stage_event/shared_stage:pathologic_stage
          type: str.lower
          default: not reported

        tumor_grade:
          path: ./shared_stage:gleason_grading/shared_stage:gleason_score
          type: str
          default: not reported

        progression_or_recurrence:
          path: "unknown"
          type: str
          default: not reported

        days_to_recurrence:
          path: "unknown"
          type: int
          maximum: 32872
          minimum: -32872
          default: null

        last_known_disease_status:
          path: "unknown"
          type: str
          default: not reported

        days_to_last_known_disease_status:
          path: "unknown"
          type: int
          maximum: 32872
          minimum: -32872
          default: null

        year_of_diagnosis:
          path: ./clin_shared:year_of_initial_pathologic_diagnosis
          type: int
          maximum: 32872
          minimum: -32872

        icd_10_code:
          path: ./clin_shared:icd_10
          type: str

        days_to_diagnosis:
          path: ./clin_shared:days_to_initial_pathologic_diagnosis
          type: int

        prior_treatment:
          path: ./shared:history_of_neoadjuvant_treatment
          type: str.title
          values:
            'No':
              - 'no'
            'Yes':
              - 'yes'
              - yes, radiation prior to resection
              - yes, pharmaceutical treatment prior to resection

exposure:
  - root: //*[local-name()='patient']
    generated_id:
      namespace: 4950f39b-2f3d-48c5-8e98-04178697ff13
      name: ./shared:bcr_patient_uuid

    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid
          nullable: false

    properties:
      submitter_id:
        path: ./shared:bcr_patient_barcode
        suffix: _exposure
        type: str

      years_smoked:
        path: ./shared:stopped_smoking_year|./clin_shared:stopped_smoking_year - ./shared:year_of_tobacco_smoking_onset|./clin_shared:year_of_tobacco_smoking_onset
        type: float

      alcohol_history:
        path: "./clin_shared:alcohol_history_documented"
        type: str.title
        default: Not Reported

      alcohol_intensity:
        path: "unknown"
        type: str

      height:
        path: "./clin_shared:height"
        type: float

      weight:
        path: "./clin_shared:weight"
        type: float

      pack_years_smoked:
        path: ./clin_shared:number_pack_years_smoked
        type: int

treatment:
  - root: //*[local-name()='patient']
    generated_id:
      namespace: 68222794-8b3b-4d1b-a944-49b7d9a0443e
      name: ./shared:bcr_patient_uuid

    edges_by_property:
      describes:
        diagnosis: 
          submitter_id: 
            path: ./shared:bcr_patient_barcode
            suffix: _diagnosis
            nullable: false

    properties:
      submitter_id:
        path: ./shared:bcr_patient_barcode
        suffix: _treatment
        type: str

      treatment_or_therapy:
        evaluator:
          name: treatment_therapy
          new_tumor_event_path: //nte:*[@preferred_name='new_tumor_event_type']
          additional_radiation_path: ./nte:additional_radiation_therapy
          additional_pharmaceutical_path: ./nte:additional_pharmaceutical_therapy
          allowed_tumor_events:
            - Biochemical evidence of disease
            - Both Locoregional and Distant Metastasis
            - Distant Metastasis
            - Extrahepatic Recurrence
            - Intrahepatic Recurrence
            - Intrapleural Progression
            - Locoregional (Urothelial tumor event)
            - Locoregional Disease
            - Locoregional Recurrence
            - Metastatic
            - Progression of Disease
            - Recurrence
            - Regional lymph node
        path:
            - //clin_shared:radiation_therapy
            - //clin_shared:postoperative_rx_tx
        term: TBD
        enum:
          - yes
          - no
          - unknown
          - not reported
        default: not reported

      treatment_intent_type:
        path: "unknown"
        term: TBD
        type: str

      therapeutic_agents:
        path: "unknown"
        term: TBD
        type: str

      days_to_treatment_start:
        path: "unknown"
        term: TBD
        type: int
        maximum: 32872
        minimum: -32872

      days_to_treatment_end:
        path: "unknown"
        term: TBD
        type: int
        maximum: 32872
        minimum: -32872
